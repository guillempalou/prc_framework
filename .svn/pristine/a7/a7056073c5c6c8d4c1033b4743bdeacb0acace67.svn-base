// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//!
//!  \file quadratic_function.test
//!
//!  Tests for the math operations on BBox classs
//!

#include <imageplus/math/algebra/least_squares_regression.hpp>
#include <cmath>

BOOST_AUTO_TEST_SUITE ( least_squares_regression );

using namespace imageplus;
using namespace imageplus::math;
using namespace imageplus::math::algebra;


BOOST_AUTO_TEST_CASE ( test_least_squares )
{

	Matrix A(47,3);
	A 	<<  1, 4.37, 5.23,
			2, 4.56, 5.74,
			3, 4.26, 4.93,
			4, 4.56, 5.74,
			5, 4.30, 5.19,
			6, 4.46, 5.46,
			7, 3.84, 4.65,
			8, 4.57, 5.27,
			9, 4.26, 5.57,
			10, 4.37, 5.12,
			11, 3.49, 5.73,
			12, 4.43, 5.45,
			13, 4.48, 5.42,
			14, 4.01, 4.05,
			15, 4.29, 4.26,
			16, 4.42, 4.58,
			17, 4.23, 3.94,
			18, 4.42, 4.18,
			19, 4.23, 4.18,
			20, 3.49, 5.89,
			21, 4.29, 4.38,
			22, 4.29, 4.22,
			23, 4.42, 4.42,
			24, 4.49, 4.85,
			25, 4.38, 5.02,
			26, 4.42, 4.66,
			27, 4.29, 4.66,
			28, 4.38, 4.90,
			29, 4.22, 4.39,
			30, 3.48, 6.05,
			31, 4.38, 4.42,
			32, 4.56, 5.10,
			33, 4.45, 5.22,
			34, 3.49, 6.29,
			35, 4.23, 4.34,
			36, 4.62, 5.62,
			37, 4.53, 5.10,
			38, 4.45, 5.22,
			39, 4.53, 5.18,
			40, 4.43, 5.57,
			41, 4.38, 4.62,
			42, 4.45, 5.06,
			43, 4.50, 5.34,
			44, 4.45, 5.34,
			45, 4.55, 5.54,
			46, 4.45, 4.98,
			47, 4.42, 4.50;

	Vector t = A.col(1);
	Vector l = A.col(2);

	Matrix X(t.rows(),2);
	X.col(0) = t;
	X.col(1).fill(1);

	LeastSquaresRegression ls;

	ls.fit(X,l);

	BOOST_CHECK_CLOSE(ls.solution()(0),-0.413304, 1e-4);
	BOOST_CHECK_CLOSE(ls.solution()(1),6.79347, 1e-4);
}

BOOST_AUTO_TEST_SUITE_END ();
