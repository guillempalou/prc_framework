// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//!
//! \file readvolume.test
//!
//! Tests for class ReadVolume
//!

#include <iostream>

#include <imageplus/core.hpp>
#include <imageplus/io/readvolume.hpp>
#include <imageplus/io/writevolume.hpp>
#include <imageplus/math/morphology/dilation.hpp>

BOOST_AUTO_TEST_SUITE ( Dilation3dSuite );

using namespace std;
using namespace imageplus;
using namespace imageplus::io;
using namespace imageplus::math::morphology;

typedef boost::mpl::list<uint8,int64,float64> DataTypes;


BOOST_AUTO_TEST_CASE( Dilation3dGeneral)
{
    ReadVolume rvol (string(TEST_DATA_PATH_R) +"/volume_toy.rle");
    VolumeGray<uint8> vol;
    Dilation<3> dil(26,3);

    rvol >> vol;

    VolumeGray<uint8> out(vol);
    out=dil.filter(vol);

    for(uint32 k=4; k<11; k++)
    {
        for (uint32 j=5; j<13; j++)
        {
            for (uint32 i=3; i<11; i++)
            {
                if (i==3 || i==10)
                {
                    BOOST_CHECK( vol(0)[i][j][k] < out(0)[i][j][k] );
                }
                else if (j==5|| j==12)
                {
                    BOOST_CHECK( vol(0)[i][j][k] < out(0)[i][j][k] );
                }
                else if (k==4|| k==10)
                {
                    BOOST_CHECK( vol(0)[i][j][k] < out(0)[i][j][k] );
                }
                else
                {
                    BOOST_CHECK_EQUAL(vol(0)[i][j][k],out(0)[i][j][k]);
                }
            }
        }
    }
}

BOOST_AUTO_TEST_SUITE_END ();
