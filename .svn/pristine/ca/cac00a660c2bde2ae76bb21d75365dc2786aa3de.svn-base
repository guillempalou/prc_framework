// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//! 
//! \file ontology.test
//!
//! Tests for Ontology class
//!
#include <imageplus/semantic/ontology.hpp>


BOOST_AUTO_TEST_SUITE ( Semantic_Ontology_Suite );

using namespace imageplus;
using namespace imageplus::semantic;
using namespace std;

BOOST_AUTO_TEST_CASE( ontology_test_name )
{
	Ontology ontology;

	// name
	string name = "OntologyName";
	ontology.set_name(name);
	BOOST_CHECK_EQUAL(ontology.get_name(), name);
}

BOOST_AUTO_TEST_CASE( ontology_test_file_uri )
{
	Ontology ontology;

	// file URI (with file: prefix)
	string file_uri = "file:/path/to/file.xml";
	ontology.set_file_uri(file_uri);
	BOOST_CHECK_EQUAL(ontology.get_file_uri(), file_uri);
	
	// file URI (without file: prefix)
	// returned file URI should be the same as before
	string file_uri_short = "/path/to/file.xml";
	ontology.set_file_uri(file_uri_short);
	BOOST_CHECK_EQUAL(ontology.get_file_uri(), file_uri);
}

BOOST_AUTO_TEST_CASE( ontology_test )
{
	Ontology ontology;

	// add a semantic class and check semantic class ID uniqueness is controlled
	ontology.add_semantic_class(1, "Anchor");
	BOOST_CHECK_THROW(ontology.add_semantic_class(1, "Hand"), ImagePlusError);

	// add another semantic class, no exception should occur
	BOOST_CHECK_NO_THROW(ontology.add_semantic_class(2, "Face"));

	// add some more semantic classes
	ontology.add_semantic_class(3, "Weather");
	ontology.add_semantic_class(4, "Body");
	ontology.add_semantic_class(5, "Hair");

	BOOST_CHECK_EQUAL(ontology.get_semantic_class_name(1), "Anchor");
	BOOST_CHECK_EQUAL(ontology.get_semantic_class_name(4), "Body");

	BOOST_CHECK(ontology.includes_semantic_class(3));
	BOOST_CHECK(! ontology.includes_semantic_class(6));
}

BOOST_AUTO_TEST_CASE( ontology_test_iterators )
{
	Ontology ontology;

	// add some semantic classes
	ontology.add_semantic_class(1, "Anchor");
	ontology.add_semantic_class(2, "Face");
	ontology.add_semantic_class(3, "Weather");
	ontology.add_semantic_class(4, "Body");
	ontology.add_semantic_class(5, "Hair");

	size_t count = 0;
	Ontology::iterator it = ontology.begin();
	while (it != ontology.end()) count += *it++;
	BOOST_CHECK(count == 1+2+3+4+5);

	count = 0;
	Ontology::const_iterator const_it = ontology.begin();
	while (const_it != ontology.end()) count += *const_it++;
	BOOST_CHECK(count == 1+2+3+4+5);
}

BOOST_AUTO_TEST_CASE( ontology_test_cout )
{
	Ontology ontology;

	// set name
	ontology.set_name("Head parts");

	// add some semantic classes
	ontology.add_semantic_class(1, "Hair");
	ontology.add_semantic_class(2, "Face");

	stringstream expected;
	expected << "Ontology name: Head parts" << endl;
	expected << "Semantic classes:"         << endl;
	expected << "  - Hair"                  << endl;
	expected << "  - Face"                  << endl;

	stringstream obtained;
	obtained << ontology;

	BOOST_CHECK_EQUAL(obtained.str(), expected.str());
}


BOOST_AUTO_TEST_SUITE_END ();
