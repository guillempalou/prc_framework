// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//! 
//! \file trainer.test
//!
//! Tests for Trainer class
//!
#include <boost/filesystem.hpp>
#include <imageplus/semantic/trainer.hpp>

#ifdef USE_XML

BOOST_AUTO_TEST_SUITE ( Semantic_Trainer_Suite );

using namespace imageplus;
using namespace imageplus::semantic;
using namespace std;

BOOST_AUTO_TEST_CASE( trainer_outputdir_test )
{
    // Annotation file
	boost::filesystem::path annotation_file = string(TEST_DATA_PATH_R);
	annotation_file /= "semantic";
	annotation_file /= "5_semantic";
	annotation_file /= "2_annotations";
	annotation_file /= "image";
	annotation_file /= "F1_publi.xml";

	// Output directory
	boost::filesystem::path output_dir = string(TEST_DATA_PATH_W);
	output_dir /= "semantic";
	output_dir /= "trainer";
	boost::filesystem::create_directories(output_dir);

	// Check trainer instantiation throws an exception if the output directory does not exist
    BOOST_CHECK_THROW(Trainer(annotation_file.string(), "/non/existent/directory"), ImagePlusError);

    // Check trainer instantiation does not throw any exception
    BOOST_CHECK_NO_THROW(Trainer(annotation_file.string(), output_dir.string()));
}

BOOST_AUTO_TEST_CASE( trainer_train_test )
{
    // Annotation file
	boost::filesystem::path annotation_file = string(TEST_DATA_PATH_R);
	annotation_file /= "semantic";
	annotation_file /= "5_semantic";
	annotation_file /= "2_annotations";
	annotation_file /= "image";
	annotation_file /= "F1_publi.xml";

	// Output directory
	boost::filesystem::path output_dir = string(TEST_DATA_PATH_W);
	output_dir /= "semantic";
	output_dir /= "detector";
	boost::filesystem::create_directories(output_dir);

    // Check normal training does not throw any exception
    Trainer trainer(annotation_file.string(), output_dir.string());
    BOOST_CHECK_NO_THROW(trainer.train());
}


BOOST_AUTO_TEST_SUITE_END ();

#endif //USE_XML
