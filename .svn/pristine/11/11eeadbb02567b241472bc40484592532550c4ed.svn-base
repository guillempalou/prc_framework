// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

/*!
 * \file coord2d.test
 */  

#include <imageplus/core/coord2d.hpp>
#include <imageplus/core/array_arithmetic.hpp>

BOOST_AUTO_TEST_SUITE ( suite_coord2d );

using namespace imageplus;

typedef boost::mpl::list< uint8, uint16, uint32, uint64, int8, int16, int32, int64 > Coord2DTypes; 

    
BOOST_AUTO_TEST_CASE_TEMPLATE( test_coord2d_basic, T, Coord2DTypes )
{
    /*
     * Default constructor
     */
    Coord2D<T> c1;
    
    BOOST_CHECK(c1.dims() == 2);
    BOOST_CHECK(c1[0] == 0);
    BOOST_CHECK(c1[1] == 0);
    
    /*
     * Init test data
     */
    c1[0] = 3;
    c1[1] = 55;
    
    /*
     * Copy constructor
     */
    Coord2D<T> c2 = c1;
    BOOST_CHECK(c2 == c1);
    BOOST_CHECK(c2.dims() == c1.dims());
    BOOST_CHECK(c2[0] == c1[0]);
    BOOST_CHECK(c2[1] == c1[1]);
    BOOST_CHECK(c2[0] == 3); 
    BOOST_CHECK(c2[1] == 55); 
    
    /*
     * Copy constructor from a different data type
     */
    Coord2D<int64> c3 = c1;
    BOOST_CHECK(c3 == c1);
    BOOST_CHECK(c3.dims() == c1.dims());
    
    BOOST_CHECK(c3[0] == int64(c1[0])); // cast necessary for signed/unsigned comparations
    BOOST_CHECK(c3[1] == int64(c1[1])); // cast necessary for signed/unsigned comparations
    
    BOOST_CHECK(c3[0] == 3);
    BOOST_CHECK(c3[1] == 55);
    
    /*
     * Specific constructors and specific access methods
     */
    Coord2D<T> c2d(4,5);
    
    BOOST_CHECK(c2d.x() == 4);
    BOOST_CHECK(c2d.y() == 5);

    /*
     * Assignement operator
     */
    BOOST_CHECK(c2d != c3); // just to be sure... 
    c2d=c3;
    BOOST_CHECK(c2d == c3);
    
    /*
     * Specific set methods
     */
    c2d.set(40,50);

    BOOST_CHECK(c2d.x() == 40);
    BOOST_CHECK(c2d.y() == 50);
    
    c2d.x() = 45;
    c2d.y() = 55;
    
    BOOST_CHECK(c2d.x() == 45);
    BOOST_CHECK(c2d.y() == 55);
    
    BOOST_CHECK(c2d.x() == c2d[0]);
    BOOST_CHECK(c2d.y() == c2d[1]);
}

BOOST_AUTO_TEST_CASE_TEMPLATE( test_coord2d_arithmetic, T, Coord2DTypes )
{
    /*
     * Init data
     */
    Coord2D<T>    c1;
    Coord2D<int8> c2;
    Coord2D<T>    out;
    for(std::size_t ii=0; ii<2; ++ii)
    {
        c1[ii] = ii;
        c2[ii] = ii;
    }
    
    /*
     * Addition and substraction
     */
    out = c1+c2;
    for(std::size_t ii=0; ii<2; ++ii)
    {
        BOOST_CHECK( out[ii] == T(2*ii));
    }
    
    out -= c1;
    for(std::size_t ii=0; ii<2; ++ii)
    {
        BOOST_CHECK( out[ii] == T(ii));
    }

    /*
     * Substraction
     */
    out = c1-c2;
    for(std::size_t ii=0; ii<2; ++ii)
    {
        BOOST_CHECK( out[ii] == 0);
    }
    
    out += c1;
    for(std::size_t ii=0; ii<2; ++ii)
    {
        BOOST_CHECK( out[ii] == T(ii));
    }
}

#ifndef NDEBUG
BOOST_AUTO_TEST_CASE_TEMPLATE( test_coord2d_assert_exceptions, T, Coord2DTypes  )
{
    /*
     * Test to just check some assert (in debug mode)
     */
    Coord2D<T> c2;
            
    BOOST_CHECK_THROW(c2.set(2)    , ImagePlusInternalError);
    BOOST_CHECK_THROW(c2.set(2,3,4), ImagePlusInternalError);

    BOOST_CHECK_THROW(c2.z(), ImagePlusInternalError);
}
#endif //NDEBUG

BOOST_AUTO_TEST_SUITE_END ();
