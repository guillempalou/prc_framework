##############################################################################
#                                                                            #
# Copyright (C) 2007 UPC All Rights Reserved.                                #
#                                                                            #
# See COPYRIGHT file enclosed with this distribution.                        #
#                                                                            #
##############################################################################

##############################################################################
#                                                                            #
#  ImagePlus Build System - Documentation Build                              #
#                                                                            #
# This script builds the project documentation.                              #
# The documentation is generated by doxygen, so here we only launch the      #
# doxygen commands.                                                          #
#                                                                            #
# There are two documentation targets:                                       #
#   - scons api -> only the public headers are documented                    #
#   - scons doc -> all headers are documented                                #
#                                                                            #
# The build system is based on SCons (http://www.scons.org/), so also this   #
# script.                                                                    #
#                                                                            #
#                                                                            #
# Note: There is a DoxygenBuilder for SCons that checks which sources need   #
#       to be rebuild: http://www.scons.org/wiki/DoxygenBuilder              #
#       Seems that this script only works properly under development         #
#       versions of SCons.                                                   #
#       For the moment all documentation is always built.                    # 
#                                                                            #
#                                                                            #
#  CREATED BY   : Albert Gil, UPC (agil@gps.tsc.upc.edu)                     #
#  DOXYFILES BY : Javier Ruiz Hidalgo, UPC (jrh@gps.tsc.upc.edu)             #
#                                                                            #
##############################################################################

Import ('*')

# To get the list of files
import glob
import os


docDoxyFile = File(docPath + 'doxygen.config')

#
# Install files to html
#
sources =  glob.glob(str(Dir(docPath + 'files'))+os.sep+'*')
for source in sources:
    env.Install( docPath + 'html/files/', source  )


#
# Documentation Check
#
# SHOW_FILES disable just to avoid not really warnings on test and tools
#
env.Command( docTarget, None, '( cat '+str(docDoxyFile)+' ; echo EXTRACT_ALL=NO ; echo SHOW_FILES=NO ; echo HTML_OUTPUT = html_check) | doxygen -')


#
# Normal Documentation
# 
env.Command( apiTarget, None, 'doxygen ' + str(docDoxyFile))


# Note that sources of Commands are not specified (None). 
# These Commands are always built due the AlwaysBuild commands below

AlwaysBuild( apiTarget )
AlwaysBuild( docTarget )



############################   NOT YET USED   ################################
# DoxygenBuilder from http://www.scons.org/wiki/DoxygenBuilder
#
#docEnv = Environment(tools = ["default", "doxygen"], toolpath = '.')
#docEnv.Doxygen("doc/doxygen_api.config")
#docEnv.Doxygen("doc/doxygen.config")
############################   NOT YET USED   ################################
