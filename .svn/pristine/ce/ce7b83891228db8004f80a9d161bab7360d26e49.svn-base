// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//! 
//! \file annotatedsemanticclass.test
//!
//! Tests for AnnotatedSemanticClass class
//!
#include <imageplus/semantic/annotatedsemanticclass.hpp>
#include <imageplus/semantic/instance.hpp>


BOOST_AUTO_TEST_SUITE ( Semantic_AnnotatedSemanticClass_Suite );

using namespace imageplus;
using namespace imageplus::semantic;
using namespace std;

BOOST_AUTO_TEST_CASE( annotatedsemanticclass_test )
{
	// annotate semantic class 2
	AnnotatedSemanticClass asc(2);

	// add 3 positive instances
	asc.add_instance(
		Instance("SegmentInstance1", "file:/path/to/0000001-vd.xml", 8,
			1, list<string>()),
		Instance::POSITIVE);
	asc.add_instance(
		Instance("SegmentInstance2", "file:/path/to/0000002-vd.xml", 8,
			1, list<string>()),
		Instance::POSITIVE);
	asc.add_instance(
		Instance("SegmentInstance3", "file:/path/to/0000003-vd.xml", 8,
			1, list<string>()),
		Instance::POSITIVE);

	// add 1 neutral instance
	asc.add_instance(
		Instance("SegmentInstance4", "file:/path/to/0000004-vd.xml", 8,
			1, list<string>()),
		Instance::NEUTRAL);

	// add 2 negative instances
	asc.add_instance(
		Instance("SegmentInstance5", "file:/path/to/0000005-vd.xml", 8,
			1, list<string>()),
		Instance::NEGATIVE);
	asc.add_instance(
		Instance("SegmentInstance6", "file:/path/to/0000006-vd.xml", 8,
			1, list<string>()),
		Instance::NEGATIVE);

	BOOST_CHECK(asc.get_instances(Instance::POSITIVE).size() == 3);
	BOOST_CHECK(asc.get_instances(Instance::NEUTRAL).size()  == 1);
	BOOST_CHECK(asc.get_instances(Instance::NEGATIVE).size() == 2);
}

BOOST_AUTO_TEST_CASE( annotatedsemanticclass_test_cout )
{
	// annotate semantic class 1
	AnnotatedSemanticClass asc(1);

	// add 2 positive instances
	asc.add_instance(
		Instance("SegmentInstance1", "file:/path/to/0000001-vd.xml", 8,
			1, list<string>()),
		Instance::POSITIVE);
	asc.add_instance(
		Instance("SegmentInstance2", "file:/path/to/0000002-vd.xml", 8,
			1, list<string>()),
		Instance::POSITIVE);

	// add 1 negative instance
	asc.add_instance(
		Instance("SegmentInstance3", "file:/path/to/0000003-vd.xml", 8,
			1, list<string>()),
		Instance::NEGATIVE);

	stringstream expected;
	expected << "Semantic class id: 1"                                    << endl;
	expected << " `- positive instances (2)"                              << endl;
	expected <<  "    `- (SegmentInstance1) file:/path/to/0000001-vd.xml" << endl;
	expected <<  "    `- (SegmentInstance2) file:/path/to/0000002-vd.xml" << endl;
	expected << " `- negative instances (1)"                              << endl;
	expected <<  "    `- (SegmentInstance3) file:/path/to/0000003-vd.xml" << endl;
	expected << " `- neutral instances (0)"                               << endl;

	stringstream obtained;
	obtained << asc;

	BOOST_CHECK_EQUAL(obtained.str(), expected.str());
}


BOOST_AUTO_TEST_SUITE_END ();
