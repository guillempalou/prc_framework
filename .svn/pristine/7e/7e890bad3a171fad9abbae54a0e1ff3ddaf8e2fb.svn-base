// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//!
//! \file readvolume.test
//!
//! Tests for class ReadVolume
//!

#include <iostream>

#include <imageplus/core.hpp>
#include <imageplus/io/readvolume.hpp>
#include <imageplus/io/writevolume.hpp>
#include <imageplus/math/morphology/erosion.hpp>

BOOST_AUTO_TEST_SUITE ( Erode3dSuite );

using namespace std;
using namespace imageplus;
using namespace imageplus::io;
using namespace imageplus::math::morphology;

typedef boost::mpl::list<uint8,int64,float64> DataTypes;


BOOST_AUTO_TEST_CASE( Erode3dGeneral)
{
    ReadVolume rvol (string(TEST_DATA_PATH_R) +"/volume_toy.rle");
    VolumeGray<uint8> vol;
    Erosion<3> erode(26,3);

    rvol >> vol;

    VolumeGray<uint8> out(vol);

    out=erode.filter(vol);


    for(uint32 k=5; k<10; k++)
    {
        for (uint32 j=6; j<12; j++)
        {
            for (uint32 i=4; i<10; i++)
            {
                if (i==4 || i==9)
                {
                    BOOST_CHECK( vol(0)[i][j][k] > out(0)[i][j][k] );
                }
                else if (j==6|| j==11)
                {
                    BOOST_CHECK( vol(0)[i][j][k] > out(0)[i][j][k] );
                }
                else if (k==5|| k==9)
                {
                    BOOST_CHECK( vol(0)[i][j][k] > out(0)[i][j][k] );
                }
                else
                {
                    BOOST_CHECK_EQUAL(vol(0)[i][j][k],out(0)[i][j][k]);
                }
            }
        }
    }
}

BOOST_AUTO_TEST_SUITE_END ();
