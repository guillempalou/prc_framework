// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//!
//! \file dilation.test
//!
//! Tests for class Dilation
//!

#include <iostream>

#include <imageplus/core.hpp>
#include <imageplus/io/readimage.hpp>
#include <imageplus/math/morphology/dilation.hpp>

BOOST_AUTO_TEST_SUITE ( DilationSuite );

using namespace imageplus;
using namespace imageplus::math::morphology;

typedef boost::mpl::list<uint8,int64> DataTypes;


BOOST_AUTO_TEST_CASE_TEMPLATE( DilationGeneral, T, DataTypes)
{
    io::ReadImage  rima_ori(std::string(TEST_DATA_PATH_R) +"/foreman_000_y.png");
    ImageGray<uint8> ori_ima;
    rima_ori >> ori_ima;

    ImageGray<T> ima = convert<T>(ori_ima);

    io::ReadImage  rima_fil(std::string(TEST_DATA_PATH_R) +"/morphology/foreman_dil.png");
    ImageGray<uint8> fil_ima;
    rima_fil >> fil_ima;

    ImageGray<T> fil = convert<T>(fil_ima);
    ImageGray<T> out;

    // Dilation, connectivity 8, kernel 3x3 (square)
    Dilation<2> dil(8,3);

    out = dil.filter(ima);

    BOOST_CHECK (out == fil);
}

BOOST_AUTO_TEST_CASE( DilationBool )
{
    io::ReadImage  rima_ori(std::string(TEST_DATA_PATH_R) +"/morphology/testmorphbool_Original.png");
    ImageGray<uint8> ori_ima;
    rima_ori >> ori_ima;

    ImageMask ima = convert(ori_ima);

    io::ReadImage  rima_fil(std::string(TEST_DATA_PATH_R) +"/morphology/testmorphbool_Dil.png");
    ImageGray<uint8> fil_ima;
    rima_fil >> fil_ima;

    ImageMask fil = convert(fil_ima);
    ImageMask out;

    // Dilation, connectivity 8, kernel 3x3 (square)
    Dilation<2> dil(8,3);

    out = dil.filter(ima);

    BOOST_CHECK (out == fil);


    // Dilation using an arbitrary structuring element (not simple)
    MultiArray<bool,2> se_ma(3,3);
    se_ma = true;

    StructuringElement<2> se(se_ma, Coord<int64,2>(1,1));

    Dilation<2> dil_se(se);

    ImageMask out2;
    out2 = dil_se.filter(ima);

    BOOST_CHECK (out2 == fil);
}

BOOST_AUTO_TEST_SUITE_END ();
