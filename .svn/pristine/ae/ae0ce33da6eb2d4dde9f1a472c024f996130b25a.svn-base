// --------------------------------------------------------------
// Copyright (C)
// Universitat Politecnica de Catalunya (UPC) - Barcelona - Spain
// --------------------------------------------------------------

//!
//!  \file imageplus/descriptors/geometry/auxiliar.hpp
//!
#ifndef IMAGEPLUS_DESCRIPTORS_GEOMETRY_AUXILIAR_HPP
#define IMAGEPLUS_DESCRIPTORS_GEOMETRY_AUXILIAR_HPP

#include <imageplus/core/visual_descriptors.hpp>

#include <imageplus/core/coord2d.hpp>

namespace imageplus
{
    namespace descriptors
    {
        //!
        //! \brief Class for visual descriptor that contains the sum of coordinates of a region.
        //!         Just for images (2D)
        //!
        //! \author Ekaterina Zaytseva <zaytseva@gps.tsc.upc.edu>
        //! \author Jordi Pont <jordi.pont@upc.edu>
        //!
        //! \date 20-7-2009  
        template<class PositionModel>
        class CoordSum : public DescriptorBase,
                         public PositionModel
        {
        public:
            //! Type of coordinate
            typedef PositionModel CoordType;
           
            //!
            //! \brief Default constructor
            //!
            CoordSum() : DescriptorBase("CoordSum",true), CoordType()
            {
            };
            
            //! \brief Calculates the sum of coordinates of a region given a pair of iterators. 
            //!
            //! \param[in] first      : Iterator to the beginning of the region
            //! \param[in] last       : Iterator to the end of the region
            //! \param[in] peer_descs : Pointer to CollaborativeDescriptors, in principle is never 0x0 but it is a good idea to ASSERT it
            template< class IteratorModel >
            void calculate(IteratorModel first, IteratorModel last, CollaborativeDescriptors* peer_descs)
            {     
                IteratorModel it=first;
                for( ; it!=last; ++it)
                {
                    (*(PositionModel*)this) = (*(PositionModel*)this) + (*it).position();
                }
            }
                    
           //! \brief Calculates recursively sum of coordinates of the father region given the sons ones.
           //!
           //! \param[in] son1_descs : CollaborativeDescriptors of the son 1
           //! \param[in] son2_descs : CollaborativeDescriptors of the son 2
           //! \param[in] peer_descs : Pointer to CollaborativeDescriptors, in principle is never 0x0 but it is a good idea to ASSERT it
           void recursive_calculate(CollaborativeDescriptors& son1_descs, CollaborativeDescriptors& son2_descs, CollaborativeDescriptors* peer_descs)
           {               
               (*(PositionModel*)this) = son1_descs.get(*this) + son2_descs.get(*this);
           }
        };
    }
}

#endif

